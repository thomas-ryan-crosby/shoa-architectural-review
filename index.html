<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanctuary HOA Architectural Review Generator</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <!-- Login Screen Modal -->
        <div id="loginScreen" class="login-screen">
            <div class="login-box">
                <button type="button" id="closeLoginBtn" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; color: var(--text-light); cursor: pointer; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s ease;" onmouseover="this.style.background='#f0f0f0'; this.style.color='#333';" onmouseout="this.style.background='none'; this.style.color='var(--text-light)';" title="Close">√ó</button>
                <h1>Sanctuary HOA</h1>
                <h2>Architectural Review Generator</h2>
                <p class="login-subtitle">Please sign in to continue</p>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" required placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Sign In</button>
                    </div>
                    <div id="loginError" class="error-message" style="display: none; margin-top: 15px;"></div>
                </form>
                <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                    <p style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 10px;">Don't have an account?</p>
                    <button type="button" id="showRegisterBtn" class="btn-secondary" style="width: 100%;">Create Account</button>
                </div>
            </div>
        </div>

        <!-- Registration Screen Modal -->
        <div id="registerScreen" class="login-screen" style="display: none;">
            <div class="login-box">
                <button type="button" id="closeRegisterBtn" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; color: var(--text-light); cursor: pointer; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s ease;" onmouseover="this.style.background='#f0f0f0'; this.style.color='#333';" onmouseout="this.style.background='none'; this.style.color='var(--text-light)';" title="Close">√ó</button>
                <h1>Create Account</h1>
                <h2>Sanctuary HOA</h2>
                <p class="login-subtitle">Your account will need admin approval</p>
                <form id="registerForm">
                    <div class="form-group">
                        <label for="registerName">Full Name</label>
                        <input type="text" id="registerName" required placeholder="John Doe">
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <input type="email" id="registerEmail" required placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <input type="password" id="registerPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6">
                        <small style="color: var(--text-light); font-size: 0.85rem;">Minimum 6 characters</small>
                    </div>
                    <div class="form-group">
                        <label for="registerPasswordConfirm">Confirm Password</label>
                        <input type="password" id="registerPasswordConfirm" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Create Account</button>
                    </div>
                    <div id="registerError" class="error-message" style="display: none; margin-top: 15px;"></div>
                    <div id="registerSuccess" class="success-message" style="display: none; margin-top: 15px;"></div>
                </form>
                <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                    <p style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 10px;">Already have an account?</p>
                    <button type="button" id="showLoginBtn" class="btn-secondary" style="width: 100%;">Sign In</button>
                </div>
            </div>
        </div>

        <!-- Main App (visible, but write operations require login) -->
        <div id="mainApp">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <div>
                    <h1>Sanctuary HOA Architectural Review Generator</h1>
                    <p class="subtitle">Generate professional approval letters for architectural reviews</p>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div id="userEmailWidget" style="display: none; align-items: center; gap: 8px; background: rgba(255, 255, 255, 0.15); padding: 8px 14px; border-radius: 20px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);">
                        <span style="font-size: 1.1rem;">üë§</span>
                        <div style="display: flex; flex-direction: column; line-height: 1.2;">
                            <span style="font-size: 0.7rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 0.5px;">Logged In As</span>
                            <span id="userEmail" style="font-size: 0.85rem; font-weight: 500; color: var(--white); max-width: 250px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title=""></span>
                        </div>
                    </div>
                    <button type="button" id="adminPanelBtn" class="btn-secondary" style="padding: 8px 16px; font-size: 0.9rem; display: none; background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); color: var(--white);">Admin Panel</button>
                    <button type="button" id="loginBtn" class="btn-secondary" style="padding: 8px 16px; font-size: 0.9rem; display: none; background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); color: var(--white);">Sign In</button>
                    <button type="button" id="logoutBtn" class="btn-secondary" style="padding: 8px 16px; font-size: 0.9rem; display: none; background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); color: var(--white);">Sign Out</button>
                </div>
            </div>
            <button type="button" id="standardsButton" class="standards-button">Refresher on SHOA Arch Standards</button>
        </header>

        <main>
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button type="button" class="tab-button active" data-tab="projects">Projects</button>
                <button type="button" class="tab-button" data-tab="households">Households & Members</button>
            </div>

            <!-- Project Overview -->
            <div id="projectsTab" class="tab-content active">
                <section class="form-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0;">Project Tracking</h2>
                        <div id="storageStatus" class="storage-status">
                            <span id="storageStatusText">Loading...</span>
                        </div>
                    </div>
                    
                    <!-- Metrics Dashboard -->
                    <div id="metricsDashboard" class="metrics-dashboard">
                        <div class="metrics-row">
                            <div class="metric-circle">
                                <div class="metric-circle-inner">
                                    <div class="metric-value-circle" id="metricDeposits">0/0</div>
                                    <div class="metric-label-circle">Deposits</div>
                                </div>
                            </div>
                            <div class="metric-circle">
                                <div class="metric-circle-inner">
                                    <div class="metric-value-circle" id="metricSiteConditions">0/0</div>
                                    <div class="metric-label-circle">Site Conditions</div>
                                </div>
                            </div>
                            <div class="metric-circle">
                                <div class="metric-circle-inner">
                                    <div class="metric-value-circle" id="metricSubmittedPlans">0/0</div>
                                    <div class="metric-label-circle">Plans</div>
                                </div>
                            </div>
                            <div class="metric-circle">
                                <div class="metric-circle-inner">
                                    <div class="metric-value-circle" id="metricApprovalLetters">0/0</div>
                                    <div class="metric-label-circle">Letters</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Deposit Summary -->
                    <div id="depositSummary" class="deposit-summary" style="background: var(--card-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 2px solid var(--primary-color);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3 style="margin: 0 0 8px 0; color: var(--text-primary); font-size: 1.1rem;">Total Builder's Deposits on File</h3>
                                <p style="margin: 0; color: var(--text-light); font-size: 0.9rem;">Net deposits received (after returns)</p>
                            </div>
                            <div style="text-align: right;">
                                <div id="totalDepositAmount" style="font-size: 2rem; font-weight: bold; color: var(--primary-color);">
                                    $0.00
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 15px;">
                        <div class="project-filters" style="flex: 1;">
                            <button type="button" class="filter-btn active" data-filter="all">All Projects</button>
                            <button type="button" class="filter-btn" data-filter="open">Open</button>
                            <button type="button" class="filter-btn" data-filter="previous">Previous</button>
                        </div>
                    </div>

                    <!-- Add Project Form -->
                    <div class="add-project-section">
                        <button type="button" class="btn-secondary" id="toggleAddProjectBtn">
                            <span id="toggleAddProjectText">+ Add Existing Project</span>
                        </button>
                        
                        <div class="add-project-form" id="addProjectForm" style="display: none;">
                            <h3>Add Existing Project</h3>
                            <div class="form-group">
                                <label for="addHomeownerName">
                                    Homeowner Name <span class="required">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="addHomeownerName" 
                                    name="addHomeownerName" 
                                    required 
                                    placeholder="e.g., Smith"
                                >
                                <span class="error-message" id="addHomeownerName-error"></span>
                            </div>

                            <div class="form-group">
                                <label for="addAddress">
                                    Property Address <span class="required">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="addAddress" 
                                    name="addAddress" 
                                    required
                                    placeholder="e.g., 113 Juniper Court"
                                >
                                <span class="error-message" id="addAddress-error"></span>
                            </div>

                            <div class="form-group">
                                <label for="addLot">
                                    Lot Number <span class="required">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="addLot" 
                                    name="addLot" 
                                    required
                                    placeholder="e.g., 434"
                                >
                                <span class="error-message" id="addLot-error"></span>
                            </div>

                            <div class="form-group">
                                <label for="addProjectType">
                                    Project Type <span class="required">*</span>
                                </label>
                                <select id="addProjectType" name="addProjectType" required>
                                    <option value="">Select a project type...</option>
                                    <option value="New Home">New Home</option>
                                    <option value="Renovation/Extension">Renovation/Extension</option>
                                    <option value="Accessory Structure">Accessory Structure</option>
                                    <option value="Pool">Pool</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>

                            <div class="form-group" id="addOtherProjectTypeGroup" style="display: none;">
                                <label for="addOtherProjectType">
                                    Specify Project Type
                                </label>
                                <input 
                                    type="text" 
                                    id="addOtherProjectType" 
                                    name="addOtherProjectType" 
                                    placeholder="Enter project type"
                                >
                            </div>

                            <div class="form-group">
                                <label for="addContractorName">
                                    Contractor Name
                                </label>
                                <input 
                                    type="text" 
                                    id="addContractorName" 
                                    name="addContractorName" 
                                    placeholder="e.g., ABC Construction"
                                >
                            </div>

                            <div class="form-group">
                                <label for="addApprovedBy">
                                    Approved By
                                </label>
                                <input 
                                    type="text" 
                                    id="addApprovedBy" 
                                    name="addApprovedBy" 
                                    placeholder="e.g., John Smith, AECC Chair"
                                >
                            </div>

                            <div class="form-section-divider">
                                <h4>Review Information</h4>
                            </div>

                            <div class="form-group">
                                <label for="addReviewCommentsType">
                                    Review Comments <span class="required">*</span>
                                </label>
                                <select id="addReviewCommentsType" name="addReviewCommentsType" required>
                                    <option value="default">The plan was reviewed for Sanctuary Setback Requirements.</option>
                                    <option value="other">Other (specify below)</option>
                                </select>
                            </div>

                            <div class="form-group" id="addOtherReviewCommentsGroup" style="display: none;">
                                <label for="addReviewComments">
                                    Specify Review Comments <span class="required">*</span>
                                </label>
                                <textarea 
                                    id="addReviewComments" 
                                    name="addReviewComments" 
                                    rows="4"
                                    placeholder="Enter your review comments"
                                ></textarea>
                                <span class="error-message" id="addReviewComments-error"></span>
                            </div>

                            <div class="form-group">
                                <label for="addApprovalReasonType">
                                    Approval Reason <span class="required">*</span>
                                </label>
                                <select id="addApprovalReasonType" name="addApprovalReasonType" required>
                                    <option value="default">The project meets Sanctuary Setback Requirements. No variances are required. Approved.</option>
                                    <option value="other">Other (specify below)</option>
                                </select>
                            </div>

                            <div class="form-group" id="addOtherApprovalReasonGroup" style="display: none;">
                                <label for="addApprovalReason">
                                    Specify Approval Reason <span class="required">*</span>
                                </label>
                                <textarea 
                                    id="addApprovalReason" 
                                    name="addApprovalReason" 
                                    rows="4"
                                    placeholder="Enter your approval reason"
                                ></textarea>
                                <span class="error-message" id="addApprovalReason-error"></span>
                            </div>

                            <div class="form-section-divider">
                                <h4>Current Site Conditions</h4>
                            </div>

                            <div class="form-group">
                                <label for="addSiteConditions">
                                    Upload Current Site Conditions (Optional)
                                </label>
                                <div id="addSiteConditionsDropZone" style="border: 2px dashed #ddd; border-radius: 8px; padding: 30px; text-align: center; margin-top: 8px; background: #fafafa; cursor: pointer; transition: all 0.3s ease;">
                                    <div id="addSiteConditionsDropZoneContent">
                                        <div style="font-size: 2rem; margin-bottom: 10px;">üì∑</div>
                                        <div style="font-weight: 500; margin-bottom: 5px;">Drag and drop files here</div>
                                        <div style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">or</div>
                                        <div style="display: inline-block; padding: 8px 16px; background: #2c5530; color: white; border-radius: 4px; font-size: 0.9rem;">Click to browse</div>
                                        <div style="font-size: 0.85rem; color: #666; margin-top: 8px;">PDF, JPG, PNG</div>
                                    </div>
                                    <div id="addSiteConditionsDropZoneFileList" style="display: none; margin-top: 10px;"></div>
                                </div>
                                <input 
                                    type="file" 
                                    id="addSiteConditions" 
                                    name="addSiteConditions" 
                                    multiple
                                    accept=".pdf,.jpg,.jpeg,.png"
                                    style="display: none;"
                                >
                                <small class="form-hint">Attach image of Google Maps or site picture (optional but recommended)</small>
                            </div>

                            <div class="form-section-divider">
                                <h4>Submitted Plans</h4>
                            </div>

                            <div class="form-group">
                                <label for="addSubmittedPlans">
                                    Upload Submitted Plans (Optional)
                                </label>
                                <div id="addSubmittedPlansDropZone" style="border: 2px dashed #ddd; border-radius: 8px; padding: 30px; text-align: center; margin-top: 8px; background: #fafafa; cursor: pointer; transition: all 0.3s ease;">
                                    <div id="addSubmittedPlansDropZoneContent">
                                        <div style="font-size: 2rem; margin-bottom: 10px;">üìê</div>
                                        <div style="font-weight: 500; margin-bottom: 5px;">Drag and drop files here</div>
                                        <div style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">or</div>
                                        <div style="display: inline-block; padding: 8px 16px; background: #2c5530; color: white; border-radius: 4px; font-size: 0.9rem;">Click to browse</div>
                                        <div style="font-size: 0.85rem; color: #666; margin-top: 8px;">PDF, JPG, PNG, DOC, DOCX</div>
                                    </div>
                                    <div id="addSubmittedPlansDropZoneFileList" style="display: none; margin-top: 10px;"></div>
                                </div>
                                <input 
                                    type="file" 
                                    id="addSubmittedPlans" 
                                    name="addSubmittedPlans" 
                                    multiple
                                    accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"
                                    style="display: none;"
                                >
                                <small class="form-hint">Upload project documents, plans, or drawings (optional but recommended)</small>
                            </div>

                            <div class="form-section-divider">
                                <h4>Approval Information</h4>
                            </div>

                            <div class="form-group">
                                <label for="addDateApproved">
                                    Date Approved
                                </label>
                                <input 
                                    type="date" 
                                    id="addDateApproved" 
                                    name="addDateApproved" 
                                >
                                <span class="error-message" id="addDateApproved-error"></span>
                                <div style="margin-top: 8px;">
                                    <label style="display: flex; align-items: center; gap: 8px; font-weight: normal; cursor: pointer;">
                                        <input 
                                            type="checkbox" 
                                            id="noApprovalOnRecord" 
                                            name="noApprovalOnRecord"
                                            style="width: auto; margin: 0;"
                                        >
                                        <span>No Approval on Record</span>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="addDateConstructionStarted">
                                    Date Construction Started
                                </label>
                                <input 
                                    type="date" 
                                    id="addDateConstructionStarted" 
                                    name="addDateConstructionStarted"
                                >
                            </div>

                            <div class="form-group">
                                <label for="addProjectStatus">
                                    Status <span class="required">*</span>
                                </label>
                                <select id="addProjectStatus" name="addProjectStatus" required>
                                    <option value="open">Open</option>
                                    <option value="under_review">Under Architectural Review</option>
                                    <option value="previous">Previous</option>
                                </select>
                            </div>

                            <div class="form-section-divider">
                                <h4>Approval Letter</h4>
                            </div>

                            <div class="form-group">
                                <label for="addApprovalLetter">
                                    Upload Approval Letter PDF (Optional)
                                </label>
                                <div id="addFileDropZone" style="border: 2px dashed #ddd; border-radius: 8px; padding: 30px; text-align: center; margin-top: 8px; background: #fafafa; cursor: pointer; transition: all 0.3s ease;">
                                    <div id="addFileDropZoneContent">
                                        <div style="font-size: 2rem; margin-bottom: 10px;">üìÑ</div>
                                        <div style="font-weight: 500; margin-bottom: 5px;">Drag and drop PDF here</div>
                                        <div style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">or</div>
                                        <div style="display: inline-block; padding: 8px 16px; background: #2c5530; color: white; border-radius: 4px; font-size: 0.9rem;">Click to browse</div>
                                    </div>
                                    <div id="addFileDropZoneFileName" style="display: none; margin-top: 10px; font-weight: 500; color: #2c5530;"></div>
                                </div>
                                <input 
                                    type="file" 
                                    id="addApprovalLetter" 
                                    name="addApprovalLetter" 
                                    accept=".pdf"
                                    style="display: none;"
                                >
                                <span class="error-message" id="addApprovalLetter-error"></span>
                                <small class="form-hint">Upload the previously issued architectural approval letter. If not provided, will show "Approval not on file".</small>
                            </div>

                            <div style="text-align: center; padding: 10px; color: #666; font-size: 0.9rem;">
                                <strong>OR</strong>
                            </div>

                            <div class="form-group" style="text-align: center;">
                                <button type="button" id="addGenerateLetterBtn" style="padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.95rem;">Generate Approval Letter from Form Data</button>
                                <small class="form-hint" style="display: block; margin-top: 8px;">Generate a new approval letter using the information in this form</small>
                            </div>

                            <div class="form-section-divider">
                                <h4>Deposit Information</h4>
                            </div>

                            <div class="form-group">
                                <label for="addDepositAmountReceived">
                                    Deposit Amount Received ($)
                                </label>
                                <input 
                                    type="number" 
                                    id="addDepositAmountReceived" 
                                    name="addDepositAmountReceived" 
                                    step="0.01"
                                    min="0"
                                    placeholder="e.g., 1000.00"
                                >
                            </div>

                            <div class="form-group">
                                <label for="addDateDepositReceived">
                                    Date Deposit Received
                                </label>
                                <input 
                                    type="date" 
                                    id="addDateDepositReceived" 
                                    name="addDateDepositReceived"
                                >
                            </div>

                            <div class="form-group">
                                <label for="addDepositAmountReturned">
                                    Deposit Amount Returned ($)
                                </label>
                                <input 
                                    type="number" 
                                    id="addDepositAmountReturned" 
                                    name="addDepositAmountReturned" 
                                    step="0.01"
                                    min="0"
                                    placeholder="e.g., 1000.00"
                                >
                            </div>

                            <div class="form-group">
                                <label for="addDateDepositReturned">
                                    Date Deposit Returned
                                </label>
                                <input 
                                    type="date" 
                                    id="addDateDepositReturned" 
                                    name="addDateDepositReturned"
                                >
                            </div>

                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 8px;">
                                    <input 
                                        type="checkbox" 
                                        id="addDepositWaived" 
                                        name="addDepositWaived"
                                    >
                                    <span>Deposit Waived</span>
                                </label>
                                <small class="form-hint">Check this if the deposit requirement was waived for this project</small>
                            </div>

                            <div class="form-group" id="addDepositWaiverReasonGroup" style="display: none;">
                                <label for="addDepositWaiverReason">
                                    Waiver Reason <span class="required">*</span>
                                </label>
                                <textarea 
                                    id="addDepositWaiverReason" 
                                    name="addDepositWaiverReason" 
                                    rows="3"
                                    placeholder="Enter the reason why the deposit was waived..."
                                ></textarea>
                                <span class="error-message" id="addDepositWaiverReason-error"></span>
                                <small class="form-hint">Required when deposit is waived</small>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn-primary" id="saveProjectBtn">Save Project</button>
                                <button type="button" class="btn-secondary" id="cancelAddProjectBtn">Cancel</button>
                            </div>
                        </div>
                    </div>

                    <div class="project-list" id="projectList">
                        <!-- Projects will be dynamically added here -->
                    </div>

                    <div class="no-projects" id="noProjects" style="display: none;">
                        <p>No projects found. Projects will appear here after you generate approval letters or add existing projects.</p>
                    </div>
                </section>
            </div>

            <!-- Households & Members Tab -->
            <div id="householdsTab" class="tab-content">
                <section class="form-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                        <h2 style="margin: 0;">Households & Members</h2>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button type="button" id="addHouseholdBtn" class="btn-secondary" style="display: none;">
                                + Add Household
                            </button>
                        </div>
                    </div>

                    <!-- Household Metrics Dashboard -->
                    <div id="householdMetricsDashboard" class="metrics-dashboard">
                        <div class="metrics-row">
                            <div class="metric-circle">
                                <div class="metric-circle-inner">
                                    <div class="metric-value-circle" id="metricTotalHouseholds">0</div>
                                    <div class="metric-label-circle">Total Households</div>
                                </div>
                            </div>
                            <div class="metric-circle">
                                <div class="metric-circle-inner">
                                    <div class="metric-value-circle" id="metricBuiltHouseholds">0</div>
                                    <div class="metric-label-circle">Built</div>
                                </div>
                            </div>
                            <div class="metric-circle">
                                <div class="metric-circle-inner">
                                    <div class="metric-value-circle" id="metricLotOnlyHouseholds">0</div>
                                    <div class="metric-label-circle">Lot Only</div>
                                </div>
                            </div>
                            <div class="metric-circle">
                                <div class="metric-circle-inner">
                                    <div class="metric-value-circle" id="metricHouseholdsWithMembers">0</div>
                                    <div class="metric-label-circle">With Members</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Search/Filter -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 15px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 200px;">
                            <input type="text" id="householdSearch" placeholder="Search by address or lot number..." style="width: 100%; padding: 10px; border: 2px solid var(--border-color); border-radius: 6px; font-size: 0.95rem;">
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <select id="householdSortBy" style="padding: 10px; border: 2px solid var(--border-color); border-radius: 6px; font-size: 0.95rem;">
                                <option value="address">Sort by Address</option>
                                <option value="lotNumber">Sort by Lot Number</option>
                            </select>
                        </div>
                    </div>

                    <!-- Household List -->
                    <div id="householdList" class="household-list">
                        <!-- Households will be dynamically added here -->
                    </div>

                    <div class="no-households" id="noHouseholds" style="display: none; text-align: center; padding: 40px; color: var(--text-light);">
                        <p>No households found. Upload a CSV file or add a household manually to get started.</p>
                    </div>
                </section>
            </div>
        </main>

        <footer>
            <p>Sanctuary Homeowners Association Architectural Review Committee</p>
        </footer>
        </div>
    </div>

    <!-- Loading Overlay -->
    <!-- Standards Modal -->
    <div class="modal-overlay" id="standardsModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Consolidated Setback & Site Improvement Standards</h2>
                <p class="modal-subtitle">(Phases 1A ‚Äì Phase 5)</p>
                <button class="modal-close" id="closeStandardsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="standards-content">
                    <section class="standards-section">
                        <h3>I. Primary Residential Building Setbacks</h3>
                        
                        <div class="phase-section">
                            <h4>Phase 1A</h4>
                            <ul>
                                <li><strong>Front</strong>
                                    <ul>
                                        <li>Lots 11‚Äì14: 30 ft</li>
                                        <li>All other lots: 40 ft</li>
                                    </ul>
                                </li>
                                <li><strong>Side</strong>
                                    <ul>
                                        <li>Corner side: 25 ft</li>
                                        <li>Interior side (except where shown): 20 ft</li>
                                        <li>Interior side (where shown): 15 ft</li>
                                        <li>Corner side (no access): 5 ft</li>
                                    </ul>
                                </li>
                                <li><strong>Rear</strong>
                                    <ul>
                                        <li>40 ft</li>
                                    </ul>
                                </li>
                                <li><strong>Special</strong>
                                    <ul>
                                        <li>Lot 27: setbacks as shown on plan</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="phase-section">
                            <h4>Phase 1A1</h4>
                            <ul>
                                <li><strong>Front:</strong> 40 ft</li>
                                <li><strong>Side (interior):</strong> 15 ft</li>
                                <li><strong>Rear</strong>
                                    <ul>
                                        <li>Standard: 40 ft</li>
                                        <li>Lot 29 only: 30 ft</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="phase-section">
                            <h4>Phase 1B</h4>
                            <ul>
                                <li><strong>Front:</strong> 40 ft</li>
                                <li><strong>Side</strong>
                                    <ul>
                                        <li>Corner side: 25 ft</li>
                                        <li>Interior side (except where shown): 20 ft</li>
                                        <li>Interior side (where shown): 15 ft</li>
                                        <li>Corner side (no access): 5 ft</li>
                                    </ul>
                                </li>
                                <li><strong>Rear:</strong> 40 ft</li>
                                <li><strong>Lots with special side setbacks:</strong> Lots 64, 65, 75‚Äì85, 92, 93, 115, 116</li>
                            </ul>
                        </div>

                        <div class="phase-section">
                            <h4>Phase 1C</h4>
                            <ul>
                                <li><strong>Front:</strong> 40 ft</li>
                                <li><strong>Side (interior):</strong> 15 ft or 20 ft (as shown)</li>
                                <li><strong>Rear:</strong> 40 ft</li>
                            </ul>
                        </div>

                        <div class="phase-section">
                            <h4>Phase 2</h4>
                            <ul>
                                <li><strong>Front:</strong> 50 ft</li>
                                <li><strong>Side</strong>
                                    <ul>
                                        <li>Corner side: 40 ft</li>
                                        <li>Interior side (except where shown): 40 ft</li>
                                        <li>Interior side (where shown): 30 ft</li>
                                        <li>Corner side (no access): 5 ft</li>
                                    </ul>
                                </li>
                                <li><strong>Rear:</strong> 75 ft</li>
                            </ul>
                        </div>

                        <div class="phase-section">
                            <h4>Phase 3A</h4>
                            <ul>
                                <li><strong>Front:</strong> 50 ft</li>
                                <li><strong>Side</strong>
                                    <ul>
                                        <li>Corner side: 40 ft</li>
                                        <li>Interior side (except where shown): 40 ft</li>
                                        <li>Interior side (where shown): 30 ft</li>
                                        <li>Corner side (no access): 5 ft</li>
                                    </ul>
                                </li>
                                <li><strong>Rear:</strong> 65 ft</li>
                            </ul>
                        </div>

                        <div class="phase-section">
                            <h4>Phase 3B</h4>
                            <ul>
                                <li><strong>Front:</strong> 50 ft</li>
                                <li><strong>Side</strong>
                                    <ul>
                                        <li>Corner side: 40 ft</li>
                                        <li>Interior side (except where shown): 40 ft</li>
                                        <li>Interior side (where shown): 30 ft or 35 ft</li>
                                        <li>Corner side (no access): 5 ft</li>
                                    </ul>
                                </li>
                                <li><strong>Rear:</strong> 65 ft</li>
                            </ul>
                        </div>

                        <div class="phase-section">
                            <h4>Phase 4A</h4>
                            <p><strong>0.5¬± Acre Lots</strong></p>
                            <ul>
                                <li><strong>Front:</strong> 40 ft (30 ft where shown)</li>
                                <li><strong>Side:</strong>
                                    <ul>
                                        <li>Corner: 25 ft</li>
                                        <li>Interior: 20 ft (15 ft where shown)</li>
                                    </ul>
                                </li>
                                <li><strong>Rear:</strong> 40 ft</li>
                            </ul>
                            <p><strong>1.0¬± Acre Lots</strong></p>
                            <ul>
                                <li><strong>Front:</strong> 50 ft</li>
                                <li><strong>Side:</strong>
                                    <ul>
                                        <li>Corner: 40 ft</li>
                                        <li>Interior: 40 ft</li>
                                    </ul>
                                </li>
                                <li><strong>Rear:</strong> 65 ft</li>
                            </ul>
                        </div>

                        <div class="phase-section">
                            <h4>Phase 4B</h4>
                            <p><strong>Standard Lots</strong></p>
                            <ul>
                                <li><strong>Front:</strong> 30 ft</li>
                                <li><strong>Side:</strong> 15 ft</li>
                                <li><strong>Rear:</strong> 30 ft</li>
                            </ul>
                            <p><strong>Lot 412</strong></p>
                            <ul>
                                <li><strong>Front:</strong> 40 ft</li>
                                <li><strong>Side:</strong> 30 ft</li>
                                <li><strong>Rear:</strong> 40 ft</li>
                            </ul>
                        </div>

                        <div class="phase-section">
                            <h4>Phase 4C</h4>
                            <p><strong>Standard (unless otherwise shown)</strong></p>
                            <ul>
                                <li><strong>Front:</strong> 30 ft</li>
                                <li><strong>Side:</strong> 15 ft</li>
                                <li><strong>Rear:</strong> 30 ft</li>
                            </ul>
                        </div>

                        <div class="phase-section">
                            <h4>Phase 5</h4>
                            <p><strong>Standard (unless otherwise shown)</strong></p>
                            <ul>
                                <li><strong>Front:</strong> 30 ft</li>
                                <li><strong>Side:</strong> 15 ft</li>
                                <li><strong>Rear:</strong> 30 ft</li>
                            </ul>
                        </div>

                        <div class="phase-section">
                            <p><strong>Governing Rule</strong></p>
                            <p>CLURO, approved PUD, or private provisions ‚Äî whichever is more restrictive</p>
                        </div>
                    </section>

                    <section class="standards-section">
                        <h3>II. Accessory Improvements ‚Äì Pools, Patios, & Courts</h3>
                        
                        <div class="phase-section">
                            <h4>Uncovered Improvements</h4>
                            <p>(Pools, tennis courts, uncovered patios)</p>
                            <ul>
                                <li><strong>Rear Setback</strong>
                                    <ul>
                                        <li>Lots &lt; 40,000 SF: 10 ft</li>
                                        <li>Lots ‚â• 40,000 SF: 20 ft</li>
                                    </ul>
                                </li>
                                <li><strong>Side Setback</strong>
                                    <ul>
                                        <li>Same as required for the primary dwelling</li>
                                    </ul>
                                </li>
                                <li><strong>Exceptions</strong>
                                    <ul>
                                        <li>AECC may grant exceptions upon site plan review</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="phase-section">
                            <h4>Covered Improvements</h4>
                            <p>(Covered patios & structures)</p>
                            <ul>
                                <li><strong>Rear Setback</strong>
                                    <ul>
                                        <li>Lots &lt; 40,000 SF: 20 ft</li>
                                        <li>Lots ‚â• 40,000 SF: 40 ft</li>
                                    </ul>
                                </li>
                                <li><strong>Side Setback</strong>
                                    <ul>
                                        <li>Same as required for the primary dwelling</li>
                                    </ul>
                                </li>
                                <li><strong>Exceptions</strong>
                                    <ul>
                                        <li>AECC approval required</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </section>

                    <section class="standards-section">
                        <h3>III. Swimming Pool & Pool Deck Standards</h3>
                        <ul>
                            <li>Must be located on the rear portion of the lot</li>
                            <li>Not visible from any street</li>
                            <li>Must be in-ground and at normal ground level</li>
                            <li>Pools are not required to be below 9.5 feet above mean sea level</li>
                            <li>Fill must be added as necessary to create an in-ground appearance</li>
                            <li>Pools must be fully enclosed by an AECC-approved fence compliant with all applicable ordinances</li>
                        </ul>
                    </section>

                    <section class="standards-section">
                        <h3>IV. Playground & Recreational Equipment</h3>
                        <p>(Playscapes, swing sets, monkey bars, play gyms)</p>
                        <ul>
                            <li><strong>Maximum height:</strong> 12 ft</li>
                            <li><strong>Location:</strong> Rear yard only</li>
                            <li><strong>Setbacks</strong>
                                <ul>
                                    <li>Lots &lt; 40,000 SF: 20 ft from rear & side</li>
                                    <li>Lots ‚â• 40,000 SF: 40 ft from rear & side</li>
                                </ul>
                            </li>
                            <li><strong>Exceptions</strong>
                                <ul>
                                    <li>AECC may grant variances upon request and site plan review</li>
                                </ul>
                            </li>
                        </ul>
                    </section>

                    <section class="standards-section">
                        <h3>V. Driveway Design & Location Standards</h3>
                        
                        <div class="phase-section">
                            <h4>Recommended materials</h4>
                            <ul>
                                <li>Pervious materials (gravel, loose pavers)</li>
                                <li>Gravel/Limestone
                                    <ul>
                                        <li>Must be bordered by AECC-approved edging</li>
                                        <li>Maximum width: 16 ft</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="phase-section">
                            <h4>Location</h4>
                            <ul>
                                <li>Driveways shall not encroach into side yard setback areas</li>
                            </ul>
                        </div>

                        <div class="phase-section">
                            <h4>Garage-adjacent paved parking</h4>
                            <ul>
                                <li>Max width: equal to garage</li>
                                <li>Max depth: 25 ft</li>
                            </ul>
                        </div>
                    </section>

                    <section class="standards-section">
                        <h3>VI. Hierarchy of Control</h3>
                        <p>All development and improvements shall comply with:</p>
                        <ol>
                            <li>Plat-specific requirements</li>
                            <li>Approved PUD / CLURO</li>
                            <li>Private covenants and AECC determinations</li>
                        </ol>
                        <p><strong>The most restrictive standard shall govern.</strong></p>
                    </section>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="closeStandardsModalBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Household Detail/Edit Modal -->
    <div class="modal-overlay" id="householdModal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 id="householdModalTitle">Household Details</h2>
                <button class="modal-close" id="closeHouseholdModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="householdForm">
                    <div class="form-group">
                        <label for="householdAddress">Address <span class="required">*</span></label>
                        <input type="text" id="householdAddress" required placeholder="e.g., 133 Juniper Court">
                    </div>
                    <div class="form-group">
                        <label for="householdLotNumber">Lot Number <span class="required">*</span></label>
                        <input type="text" id="householdLotNumber" required placeholder="e.g., 434">
                    </div>
                    <div id="householdMembersSection" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                        <h3 style="margin-bottom: 15px;">Members</h3>
                        <div id="householdMembersList">
                            <!-- Members will be listed here -->
                        </div>
                        <button type="button" id="addMemberBtn" class="btn-secondary" style="margin-top: 10px; display: none;">+ Add Member</button>
                    </div>
                    <input type="hidden" id="householdId">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="saveHouseholdBtn" class="btn-primary">Save</button>
                <button type="button" id="cancelHouseholdBtn" class="btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Member Modal -->
    <div class="modal-overlay" id="addMemberModal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Add Member to Household</h2>
                <button class="modal-close" id="closeAddMemberModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addMemberForm">
                    <div class="form-group">
                        <label for="memberEmail">Email <span class="required">*</span></label>
                        <input type="email" id="memberEmail" required placeholder="member@example.com">
                        <small class="form-hint">Member must have an existing account in the system</small>
                    </div>
                    <div class="form-group">
                        <label for="memberName">Name</label>
                        <input type="text" id="memberName" placeholder="Full Name">
                    </div>
                    <div class="form-group">
                        <label for="memberRole">Role <span class="required">*</span></label>
                        <select id="memberRole" required>
                            <option value="household_admin">Household Admin</option>
                            <option value="household_member">Household Member</option>
                        </select>
                    </div>
                    <input type="hidden" id="addMemberHouseholdId">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="saveMemberBtn" class="btn-primary">Add Member</button>
                <button type="button" id="cancelMemberBtn" class="btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner-large"></div>
            <p>Generating your approval letter...</p>
        </div>
    </div>

    <!-- Preload logo for better reliability -->
    <img id="logoPreload" src="assets/logo/sanctuary logo.jpg" style="display: none;" alt="Sanctuary Logo" onload="console.log('Logo preloaded successfully')" onerror="console.error('Logo preload failed')">

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    
    <!-- Firebase Config (user needs to add their config) -->
    <script src="js/firebase-config.js"></script>
    
    <!-- User Management (must load before auth-handler) -->
    <script src="js/user-manager.js"></script>
    <script src="js/admin-panel.js"></script>
    
    <!-- Authentication Handler (must load before project-manager) -->
    <script src="js/auth-handler.js"></script>
    
    <script src="js/logo-data.js"></script>
    <script src="js/builders-rules-data.js"></script>
    <script src="js/form-handler.js"></script>
    <script src="js/file-handler.js"></script>
    <script src="js/pdf-generator.js"></script>
    <script src="js/project-manager.js"></script>
    <script src="js/household-data.js"></script>
    <script src="js/household-manager.js"></script>
    <script src="js/app.js"></script>
</body>
</html>

